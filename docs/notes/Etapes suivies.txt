											---------------------------------------
											 P4L1 - Prj. TomTroc - Etapes suivies
												Date : Samdi 6 décembre 2025
												Maj : Lundi 10 décembre 2025   
											---------------------------------------
											
1. ANALYSE DU PROJET
	a) Commande sur site OC
	
	b) Spécifications fonctionnelles
	
	c) Maquette et prototype du site 
	
2. INITIALISATION DU PROJET
	BDD : tomtroc
		Relations entre les tables :
		--------------------------
			Voir aussi la représentation ERD (Entity Relation Diagram) sous :
				/docs/architecture/erd_tomtroc.puml

			1. users ↔ books
				Relation : 1 utilisateur possède plusieurs livres (1-N) :
					books.user_id  →  users.id
				Contrainte (suppression en cascade - éviter les données orphelines) :
					CONSTRAINT fk_books_user
						FOREIGN KEY (user_id) REFERENCES users(id)
						ON DELETE CASCADE
	
			2. users ↔ messages (expéditeur)
				Relation : 1 utilisateur peut envoyer plusieurs messages (1-N)	
					messages.sender_id → users.id
					
			3. users ↔ messages (destinataire)
				Relation : 1 utilisateur peut recevoir plusieurs messages (1-N)	
				
				→ Le modèle "messagerie" est donc défini avec deux FK pointant vers la même table users.
	
		Création de BDD : tomtroc
		-------------------------
			CREATE DATABASE IF NOT EXISTS tomtroc
			  CHARACTER SET utf8mb4
			  COLLATE utf8mb4_unicode_ci;

			USE tomtroc;

			CREATE TABLE users (
				id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
				pseudo VARCHAR(50) NOT NULL,
				email VARCHAR(255) NOT NULL,
				password_hash VARCHAR(255) NOT NULL,
				created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
				updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
				CONSTRAINT uq_users_email UNIQUE (email),
				CONSTRAINT uq_users_pseudo UNIQUE (pseudo)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


			CREATE TABLE books (
				id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
				user_id INT UNSIGNED NOT NULL,
				title VARCHAR(255) NOT NULL,
				author VARCHAR(255) NOT NULL,
				description TEXT NOT NULL,
				image_path VARCHAR(255) NULL,
				status ENUM('available', 'unavailable') NOT NULL DEFAULT 'available',
				created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
				updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

				CONSTRAINT fk_books_user
					FOREIGN KEY (user_id) REFERENCES users(id)
					ON DELETE CASCADE,

				INDEX idx_books_user (user_id),
				INDEX idx_books_status (status),
				INDEX idx_books_title (title)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


			CREATE TABLE messages (
				id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
				sender_id INT UNSIGNED NOT NULL,
				receiver_id INT UNSIGNED NOT NULL,
				content TEXT NOT NULL,
				created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
				updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
				read_at DATETIME NULL DEFAULT NULL,

				CONSTRAINT fk_messages_sender
					FOREIGN KEY (sender_id) REFERENCES users(id)
					ON DELETE CASCADE,

				CONSTRAINT fk_messages_receiver
					FOREIGN KEY (receiver_id) REFERENCES users(id)
					ON DELETE CASCADE,

				INDEX idx_messages_receiver_created (receiver_id, created_at),
				INDEX idx_messages_pair (sender_id, receiver_id, created_at)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
	
	
		Git/Gihub :
		---------
			Création de la repo. github : oc-4-1-TomTroc
			
			git init
			git add .
			git commit -m "Initial commit – project structure + SQL schema + base MVC"
			git branch -M main
			git remote add origin https://github.com/toncompte/oc-4-1-TomTroc.git
			git push -u origin main	

3. CREATION/MISE EN PLACE DU SQUELETTE MVC
	- Structure du project
	- Autoloader (spl) (suppression de composer/phpdotenv car non autorisé dans le prj)
	- router
	- front controller
	- Gestion des erreurs (403 / 404 / 500)
	- Système de configuration
	- Rendu MVC
	- Layouts
	- Database manager

	git add .
	git commit -m "feat(core): implement MVC foundation, routing, config system and error handling

	- Added custom autoloader
	- Implemented centralized configuration system (Config class + /config files)
	- Added front controller with global exception handling (DEV/PROD modes)
	- Added HTTP error handling (403, 404, 500) with dedicated views
	- Improved Router to throw HTTP exceptions
	- Added base Controller with render() and renderError() workflows
	- Implemented unified layouts for normal and error views
	- Create & Updated Database manager to use config system
	- Clean project structure and prepared foundation for feature development
	"

4. CRÉATION DS FEATURES

	1) FEATURE AUTH
	===============

		BRANCHE
		-------
			git checkout -b feature/auth

		OBJECTIF
		--------
			Implémenter un système complet d'authentification :
				- Session sécurisée
				- Inscription
				- Connexion
				- Déconnexion
				- Page Mon Compte
				- Gestion des erreurs et messages flash

		A) SESSION
		----------
			Ajout /app/Core/Session.php
			Adaptation du front-controller (public/index.php)

			PRINCIPE DE FONCTIONNEMENT
			--------------------------
				• Connexion réussie :
					Session::set('user_id', $user->getId());
					Session::addFlash('success', 'Connexion réussie.');

				• Vérification d'accès :
					if (! Session::isLogged()) {
						throw new HttpForbiddenException(
							'Vous devez être connecté pour accéder à cette page.'
						);
					}

				• Déconnexion :
					Session::destroy();

				• Messages flash dans le layout :
					$success = Session::getFlashes('success');
					$errors  = Session::getFlashes('error');

		B) AUTHENTIFICATION
		-------------------
			1. Modèle User : app/Models/User.php
				Roles du modèle :
					(1) Représenter les données venant de la BDD (hydratation)
					(2) Représenter les données venant du formulaire (front)
				Workflow MVC :
					Front → Controller → Validation → User (modèle) → Repository → BDD
					BDD   → Repository → User (modèle) → Controller → Vue

			2. UserRepository : app/Repositories/UserRepository.php
				- findByEmail()
				- findByPseudo()
				- findById()
				- create()
				- verifyCredentials()
				- hydrateUser()

			3. AuthController : app/Controllers/AuthController.php
				- registerForm()
				- register()
				- loginForm()
				- login()
				- logout()

			4. Vues :
				views/auth/register.php
				views/auth/login.php

			5. Ajout des routes :
				GET  /register
				POST /register
				GET  /login
				POST /login
				GET  /logout

		C) COMPTE UTILISATEUR
		---------------------
			Contrôleur :
				app/Controllers/AccountController.php

			Vue :
				views/account/index.php

			Nouvelle route :
				GET /account   (accès restreint)

		D) VERSIONING GIT/GITHUB
		------------------------
			git status
			git add .
			git commit -m "feat(auth): implement full authentication module

			- Added AuthController (register/login/logout)
			- Added AccountController and /account protected page
			- Added register and login views (flash + old values)
			- Extended Session with flash system + getUserId()
			- Added User model (pseudo, email, passwordHash)
			- Added UserRepository (find, create, credentials)
			- Added routes + access control via HttpForbiddenException
			"

			git push origin feature/auth

			Sur GitHub :
				- Créer la Pull Request
				- Rédiger titre + description
				- Merger
				- Supprimer la branche distante

			En local :
				git checkout main
				git pull
				git branch -d feature/auth

	2) FEATURE BOOKS
	================
		BRANCHE
		-------	
			git checkout -b feature/books
